<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuş Seslendirme Uygulaması</title>
    <style>
        /* Stil kısmı */
    </style>
</head>
<body>
    <div class="container">
        <h1>Kuş Seslendirme Uygulaması</h1>
        
        <div class="record-section">
            <h2>Ses Dosyası Seç</h2>
            <input type="file" id="audio-file" accept="audio/*">
            <span id="audio-status"></span>
        </div>
        
        <div class="playlist-section">
            <h2>Çalma Listesi</h2>
            <div id="playlist"></div>
            <div id="player-status" class="status">Hazır</div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let audioFile = null;
            let audio = new Audio();
            let isPlaying = false;
            let audioContext = new (window.AudioContext || window.webkitAudioContext)();
            let analyser = audioContext.createAnalyser();
            let microphoneStream = null;
            let audioFileInput = document.getElementById('audio-file');
            let audioStatus = document.getElementById('audio-status');
            let playerStatus = document.getElementById('player-status');

            // Ses dosyasını yükle
            audioFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file && file.type.startsWith('audio/')) {
                    audioFile = URL.createObjectURL(file);
                    audio.src = audioFile;
                    audioStatus.textContent = `Dosya yüklendi: ${file.name}`;
                } else {
                    audioStatus.textContent = 'Geçersiz dosya türü!';
                }
            });

            // Mikrofonu başlat
            function startMicrophone() {
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then((stream) => {
                        microphoneStream = stream;
                        let source = audioContext.createMediaStreamSource(stream);
                        source.connect(analyser);
                        analyser.fftSize = 256;
                        let bufferLength = analyser.frequencyBinCount;
                        let dataArray = new Uint8Array(bufferLength);
                        detectSound(dataArray);
                    })
                    .catch((error) => {
                        console.error('Mikrofon hatası: ', error);
                    });
            }

            // Ses seviyesi algılama
            function detectSound(dataArray) {
                analyser.getByteFrequencyData(dataArray);

                // Eşik değerini kontrol et (örneğin, 100)
                let totalVolume = 0;
                for (let i = 0; i < dataArray.length; i++) {
                    totalVolume += dataArray[i];
                }
                let averageVolume = totalVolume / dataArray.length;

                if (averageVolume > 100 && !isPlaying) { // Ses eşik değeri
                    playSound();
                }

                // Ses seviyesini her 100ms'de bir kontrol et
                requestAnimationFrame(() => detectSound(dataArray));
            }

            // Ses dosyasını çalma
            function playSound() {
                if (audioFile && !isPlaying) {
                    isPlaying = true;
                    playerStatus.textContent = 'Çalıyor...';
                    audio.play();
                    audio.onended = () => {
                        isPlaying = false;
                        playerStatus.textContent = 'Hazır';
                    };
                }
            }

            // Mikrofonu başlatma
            startMicrophone();
        });
    </script>
</body>
</html>
